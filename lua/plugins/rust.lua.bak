return {}

return {
  -- Disable AstroLSP's built-in rust_analyzer handler
  { "AstroNvim/astrolsp", opts = { handlers = { rust_analyzer = false } } },

  -- Add rustaceanvim
  {
    "mrcjkb/rustaceanvim",
    version = "^5",  -- or "^6" if a new major drops; check GitHub
    lazy = false,    -- important: load early for ft=rust detection
    opts = function(_, opts)
      local astrolsp = require "astrolsp"
      local astrolsp_opts = astrolsp.lsp_opts "rust_analyzer" or {}

      -- Merge AstroLSP defaults with your custom rust-analyzer settings
      opts.server = require("astrocore").extend_tbl(astrolsp_opts, {
        settings = function(project_root, default_settings)
          local ra = require "rustaceanvim.config.server"
          return ra.load_rust_analyzer_settings(project_root, {
            settings_file_pattern = "rust-analyzer.json",  -- optional: load from project file
            default_settings = require("astrocore").extend_tbl(default_settings or {}, {
              ["rust-analyzer"] = {
                check = { command = "clippy", extraArgs = { "--", "--no-deps", "-W", "clippy::pedantic" } },
                cargo = { allFeatures = true },
                inlayHints = { enable = true },
              },
            }),
          })
        end,
        -- Add on_attach for custom keymaps if needed
        on_attach = function(client, bufnr)
          -- e.g., your leader mappings
        end,
      })

      return opts
    end,
    config = function(_, opts)
      vim.g.rustaceanvim = require("astrocore").extend_tbl(opts, vim.g.rustaceanvim or {})
    end,
  },

  -- Ensure rust-analyzer is installed via mason (optional but recommended)
  {
    "WhoIsSethDaniel/mason-tool-installer.nvim",
    opts = { ensure_installed = { "rust-analyzer" } },
  },
}
